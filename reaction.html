<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Reaction Time Tester — GameHub</title>
  <style>
    :root{
      --bg:#121212;          /* Dark theme background */
      --text:#f5f5f5;        /* Primary text */
      --accent:#4cc9f0;      /* Accent */
      --red:#b83b3b;         /* Wait */
      --green:#1db954;       /* Go */
      --muted:#9aa1a9;       /* Subtle text */
      --card:#1b1b1b;
    }
    *{box-sizing:border-box}
    html,body{height:100%;}
    html{background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;}
    body{
      margin:0; overflow:hidden; /* no scrollbars */
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      touch-action:none; /* prevent double-tap zoom & gestures */
      overscroll-behavior:none; /* prevent pull-to-refresh */
      -webkit-user-select:none; user-select:none;
      -webkit-tap-highlight-color: transparent;
    }

    /* Fullscreen interactive stage */
    .stage{
      position:relative;
      display:grid; place-items:center;
      width:100%; height:100dvh; /* responsive to mobile chrome */
      transition: background-color 250ms ease;
      background:var(--card);
      outline:none; /* we'll provide our own focus ring when needed */
    }
    .stage:focus-visible{ box-shadow:0 0 0 3px color-mix(in oklab, var(--accent) 60%, transparent); }

    /* Color states */
    .state-idle{ background:var(--card); }
    .state-wait{ background:var(--red); }
    .state-go{ background:var(--green); }

    .hud{
      position:absolute; inset:auto 0 0 0; padding:16px 20px;
      display:flex; justify-content:space-between; align-items:center;
      font-size:14px; color:var(--muted);
      pointer-events:none; /* let taps go through */
    }
    .best{ color:var(--accent); font-weight:600; }

    .content{
      text-align:center; max-width:min(92vw, 720px); padding:24px;
    }
    h1{ margin:0 0 8px; font-size:clamp(22px, 3.5vw, 28px); font-weight:700; letter-spacing:.2px; }
    p.lead{ margin:0 0 16px; color:var(--muted); font-size:clamp(14px, 2.5vw, 16px); }

    .big{ font-variant-numeric:tabular-nums;
      font-size: clamp(28px, 9vw, 84px); font-weight:800; letter-spacing: .5px; }

    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:.6rem;
      background:color-mix(in oklab, var(--accent) 20%, #000);
      color:var(--text); border:1px solid color-mix(in oklab, var(--accent) 35%, transparent);
      padding:12px 18px; border-radius:16px; font-weight:700; font-size:16px; text-decoration:none;
      cursor:pointer; transition: transform .06s ease, background-color .2s ease, box-shadow .2s ease;
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn:active{ transform: translateY(0); }
    .btn:focus-visible{ outline:3px solid color-mix(in oklab, var(--accent) 70%, transparent); outline-offset:2px; }

    .hidden{ display:none !important; }

    .kbd{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: .9em; background:#00000050; padding:.1em .4em; border-radius:.4em; border:1px solid #ffffff22 }

    /* Subtle top-left brand */
    .brand{ position:absolute; top:12px; left:16px; font-size:12px; color:var(--muted); letter-spacing:.3px; }

    /* Respect safe areas on iOS */
    .stage{ padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left); }
  </style>
</head>
<body>
  <main id="stage" class="stage state-idle" tabindex="0" aria-describedby="a11y-live" aria-label="Reaction time tester interactive area">
    <div class="brand">GameHub • Reaction Time</div>

    <div class="content">
      <!-- Dynamic headline/state text -->
      <div id="title" class="big" aria-hidden="true">Reaction Time Tester</div>
      <p id="subtitle" class="lead" aria-hidden="true">Click <span class="kbd">Start</span> and wait for green, then tap/click as fast as you can.</p>

      <!-- Start / Try Again buttons -->
      <button id="startBtn" type="button" class="btn" aria-label="Start the test">Start</button>
      <button id="againBtn" type="button" class="btn hidden" aria-label="Try again">Try Again</button>
    </div>

    <!-- HUD -->
    <div class="hud">
      <div>Desktop: click or <span class="kbd">Space</span>/<span class="kbd">Enter</span> • Mobile: tap anywhere</div>
      <div class="best" id="bestOut">Best: —</div>
    </div>

    <!-- Screen reader live region -->
    <div id="a11y-live" aria-live="polite" style="position:absolute; width:1px; height:1px; overflow:hidden; clip:rect(0 0 0 0); white-space:nowrap;">Ready</div>
  </main>

  <script>
    (function(){
      'use strict';

      /*** DOM refs ***/
      const stage   = document.getElementById('stage');
      const title   = document.getElementById('title');
      const subtitle= document.getElementById('subtitle');
      const startBtn= document.getElementById('startBtn');
      const againBtn= document.getElementById('againBtn');
      const bestOut = document.getElementById('bestOut');
      const live    = document.getElementById('a11y-live');

      /*** State ***/
      /**
       * states: 'idle' → show Start
       *         'wait' → red, waiting random delay
       *         'go'   → green, waiting for user to react
       *         'result' → showing time OR too-soon
       */
      let state = 'idle';
      let timerId = null;       // for random delay timeout
      let goAt = 0;             // performance.now() when green shown
      let best = loadBest();
      updateBestHud();
      stage.focus();

      /*** Event wiring ***/
      startBtn.addEventListener('click', startGame);
      againBtn.addEventListener('click', resetToIdle);

      // Primary interaction: taps/clicks/keys anywhere on stage
      stage.addEventListener('pointerdown', onPrimaryAction);
      // Prevent context-menu long-press on mobile from interrupting
      stage.addEventListener('contextmenu', (e)=> e.preventDefault());
      // Keyboard support: Space / Enter
      window.addEventListener('keydown', (e)=>{
        if (e.code === 'Space' || e.code === 'Enter'){ e.preventDefault(); onPrimaryAction(e); }
      }, {passive:false});

      /*** Core logic ***/
      function startGame(){
        if (state !== 'idle') return;
        setState('wait');
        const randomDelay = Math.floor(2000 + Math.random()*3001); // 2000–5000ms
        clearTimeout(timerId);
        timerId = setTimeout(()=>{
          goAt = performance.now();
          setState('go');
        }, randomDelay);
      }

      function onPrimaryAction(evt){
        // Allow button clicks to bubble normally in idle/result
        if (state === 'idle') return; // must press Start

        if (state === 'wait'){
          // too soon
          clearTimeout(timerId);
          showTooSoon();
          return;
        }
        if (state === 'go'){
          const reactedAt = performance.now();
          const ms = Math.max(0, Math.round(reactedAt - goAt));
          showResult(ms);
          return;
        }
        if (state === 'result'){
          // ignore taps unless user hits Try Again
          return;
        }
      }

      function showTooSoon(){
        setState('result');
        stage.classList.remove('state-go');
        stage.classList.add('state-wait');
        title.textContent = 'Too Soon!';
        subtitle.textContent = 'Tap when the screen turns green. Tap \"Try Again\" to restart.';
        againBtn.classList.remove('hidden');
        startBtn.classList.add('hidden');
        announce('Too soon. Try again.');
      }

      function showResult(ms){
        setState('result');
        stage.classList.remove('state-wait');
        stage.classList.add('state-idle');
        title.textContent = ms + ' ms';
        title.setAttribute('aria-label', ms + ' milliseconds');
        subtitle.textContent = 'Your reaction time';
        againBtn.classList.remove('hidden');
        startBtn.classList.add('hidden');
        announce('Your reaction time is ' + ms + ' milliseconds.');
        // Persist best
        if (best === null || ms < best){
          best = ms; saveBest(best); updateBestHud();
        }
      }

      function resetToIdle(){
        clearTimeout(timerId);
        setState('idle');
        stage.classList.remove('state-wait','state-go');
        stage.classList.add('state-idle');
        title.textContent = 'Reaction Time Tester';
        subtitle.textContent = 'Click Start and wait for green, then tap/click as fast as you can.';
        startBtn.classList.remove('hidden');
        againBtn.classList.add('hidden');
        announce('Ready');
        stage.focus();
      }

      function setState(next){
        state = next;
        if (next === 'wait'){
          stage.classList.remove('state-idle','state-go');
          stage.classList.add('state-wait');
          title.textContent = 'Wait for Green…';
          subtitle.textContent = 'Don\'t tap early!';
          announce('Wait for green');
        } else if (next === 'go'){
          stage.classList.remove('state-idle','state-wait');
          stage.classList.add('state-go');
          title.textContent = 'GO!';
          subtitle.textContent = 'Tap anywhere NOW!';
          announce('Go');
        }
      }

      /*** Best score persistence ***/
      const LS_KEY = 'reaction_best_ms';
      function loadBest(){
        try{
          const raw = localStorage.getItem(LS_KEY);
          return raw === null ? null : (Number.isFinite(+raw) ? +raw : null);
        }catch(e){ return null; }
      }
      function saveBest(ms){
        try{ localStorage.setItem(LS_KEY, String(ms)); }catch(e){}
      }
      function updateBestHud(){
        bestOut.textContent = 'Best: ' + (best==null ? '—' : (best + ' ms'));
      }

      /*** A11y live announcements ***/
      function announce(text){
        // Toggle content to ensure SRs re-announce
        live.textContent = '';
        // Force a slight delay for some SRs to pick up changes
        // but keep it synchronous for simplicity
        live.textContent = text;
      }

      // Optional: expose a quick restart via URL hash #reset
      if (location.hash === '#reset'){ saveBest(null); try{localStorage.removeItem(LS_KEY);}catch(e){} }

    })();
  </script>
</body>
</html>
